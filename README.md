# DevOps Setup on OpenShift

A demo DevOps setup with three projects:
* CI/CD - For `ImageStream`s and `Build`s, and CI/CD tools.
* DEV - For *dev* version of the project.
* QA - for *qa* version of the project.

# Setup

Run `./easy-button.sh` to:
* Create all projects.
* Grant `image-puller` access on the CI/CD project to the app-dev and app-qa projects.
* Grant `admin` access on **dev** and **qa** projects to Jenkins service account.
* Create **build template** in CI/CD project to create build and Jenkins pipeline builds.
* Create application templates in the CI/CD project for use across dev and qa projects.
* Instantiate Jenkins (persistent), Sonatype Nexus 2, SonarQube, and Dependency Track.

**Note:** Monitor the CI/CD project and wait for all pods to start before moving on to the next step.  It's not a bad idea to let thing settle for a few minutes even after everything looks like it has started.  Some of the apps still do quite a bit of initialization behind the scenes.

# Setup Jenkins to use Dependency Track

* Open Dependency Track from the URL exposed by the Dependency Track route in the CI/CD project.
* The first time you login, use the credentials "admin/admin", then change your password when prompted.
* Log back in.
* Go to `Administration -> Access Management -> Teams -> Administrators`
* Under `API keys`, click the `plus` icon to generate a new API key.  Copy it.
* Open Jenkins from the URL exposed by the Jenkins route in the CI/CD project.  Login with your OpenShift credentials.
* Click "Manage Jenkins" from the left menu.
* Scroll down and click "Conifigure System".
* Search for `Dependency-Track`
* For `Dependency-Track URL`: `http://dependency-track:8080`
* For `API Key`: Paste the API key you copied.
* Check `Auto Create Projects`
* Click **Test Connection**.  If this is successful, click **Save**.

# Start the Builds!

* In the CI/CD Project, navigate to `Builds -> Pipelines`
* You should see two pipelines; one for *frontend* and one for *backend*.  Start the pipelines by clicking the **Start pipeline** buttons associated with each build.
* The first time a pipeline runs it may take several minutes to start. This is because OpenShift will have to pull the "maven" Jenkins agent and start it up.  This is normal, once a build runs on each of your app nodes, it starts much faster as the image will be cached.
* You can see the progress from the pipeline screen, or by clicking **View Log** and watching the build logs in Jenkins.
* If you go to `DEV: App` or `QA: App` before running the pipline you'll notice they are empty.  This is normal.  The first time the pipeline runs it will setup each environment.
* Subsequent pipeline funs simply "rollout" the new container images to each environemnt.

# Did it work?

* Once the apps have been deployed to an enviornment, click on the route URL for the **frontend** app.  If it works, you'll get a very plain screen that shows a random number.  This is actually being generated by the backend app.  The frontend app calls a RESTful web service to get the next random number from the backend app.
